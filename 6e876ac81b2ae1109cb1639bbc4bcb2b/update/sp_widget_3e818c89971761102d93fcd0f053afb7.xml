<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[ (function() {
  var chatButton = document.querySelector('.help-button');
  var chatFrame = document.querySelector('.chat-frame');

 

  chatButton.addEventListener('click', function() {
    // Toggle chat window visibility
    var isWindowVisible = chatFrame.style.display !== 'none';
    chatFrame.style.display = isWindowVisible ? 'none' : 'block';

 

    // Check if the chat window is visible
    if (isWindowVisible) {
      // Mark all messages as read
      chatFrame.contentWindow.postMessage({ type: 'markAllMessagesRead' }, '*');
    } else {
      // Reset unread message count
      chatButton.classList.remove('state-unread');
    }
  });

 

  // Listen for new messages from the chat frame
  window.addEventListener('message', function(event) {
    var data = event.data;
    if (data && data.type === 'newMessage') {
      // Increment unread message count
      chatButton.classList.add('state-unread');
    }
  });
})();





]]></client_script>
        <controller_as>$ctrl</controller_as>
        <css>.conversation-button-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
}

 

.conversation-container {
  width: 300px;
  height: 400px;
  background-color: #ffffff;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
}

 

.chat-frame {
  width: 100%;
  height: 100%;
}

 

.help-button {
  position: absolute;
  bottom: 0;
  right: 0;
  width: 60px;
  height: 60px;
  border: none;
  border-radius: 50%;
  color: #ffffff;
  font-size: 24px;
  cursor: pointer;
}

 

.help-button .hover-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.2);
  border-radius: 50%;
  opacity: 0;
  transition: opacity 0.2s ease-in-out;
}

 

.help-button:hover .hover-overlay {
  opacity: 1;
}

 

.help-icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

 

.help-icon.icon-open {
  background-color: #0078d4;
  width: 40px;
  height: 40px;
  border-radius: 50%;
}

 

.help-icon.icon-close {
  background-color: #dc3545;
  width: 30px;
  height: 30px;
  border-radius: 50%;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>arcbot</id>
        <internal>false</internal>
        <link><![CDATA[function(){}]]></link>
        <name>Arcbot</name>
        <option_schema>[{"hint":"The color of the floating button which opens the virtual agent service portal widget button.","name":"button_color","section":"Presentation","default_value":"#8D8DE0","label":"Floating Button Color","type":"string"},{"hint":"The URL parameters to pass to the VA client, for example: sysparm_live_agent_queue=abc123&amp;sysparm_conversation=xzy456","name":"va_url_params","section":"Behavior","label":"Virtual Agent Client URL Parameters","type":"string"}]</option_schema>
        <public>true</public>
        <roles/>
        <script><![CDATA[
(function() {
  /*populate the 'data' object 
  e.g., data.table = $sp.getValue('table');*/
	
	var instanceGR = $sp.getInstanceRecord();
	
	options.va_url_params = options.va_url_params || "";
	options.button_color = options.button_color || "red";
})();

]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>CC-Supradhar</sys_created_by>
        <sys_created_on>2023-06-06 04:10:06</sys_created_on>
        <sys_id>3e818c89971761102d93fcd0f053afb7</sys_id>
        <sys_mod_count>15</sys_mod_count>
        <sys_name>Arcbot</sys_name>
        <sys_package display_value="AuctionArc" source="x_1046400_auction">6e876ac81b2ae1109cb1639bbc4bcb2b</sys_package>
        <sys_policy/>
        <sys_scope display_value="AuctionArc">6e876ac81b2ae1109cb1639bbc4bcb2b</sys_scope>
        <sys_update_name>sp_widget_3e818c89971761102d93fcd0f053afb7</sys_update_name>
        <sys_updated_by>CC-Harsha</sys_updated_by>
        <sys_updated_on>2023-06-06 06:28:40</sys_updated_on>
        <template><![CDATA[

<div class="conversation-button-container">

  <div class="conversation-region fade" ng-class="{'open': $ctrl.isWindowVisible}">

    <div class="sn-connect sn-connect-floating">

      <div class="sn-connect-floating-wrapper loaded">

        <div class="conversation-container">

          <iframe title="${Arc-Bot}" class="chat-frame" scrolling="no" horizontalscrolling="no" verticalscrolling="no" frameborder="none" ng-src="{{$ctrl.vaSource}}">

          </iframe>

        </div>

      </div>

    </div>

  </div>

  <button aria-label="{{$ctrl.helpButtonAriaLabel}}"

          class="help-button"

          ng-attr-tabindex="0"

          ng-class="{'state-open': $ctrl.isWindowVisible, 'state-unread': $ctrl.hasUnreadMessages}"

          ng-click="$ctrl.toggleWindow()"

          ng-style="{'background-color': $ctrl.options.button_color}"

          ng-attr-tabindex="0">

    <div class="hover-overlay"></div>

    <span aria-hidden="true" ng-class="$ctrl.isWindowVisible ? 'help-icon icon-close icon-cross' : 'help-icon icon-open sn-va-widget-icon'"></span>

  </button>

</div>


    
 ]]></template>
    </sp_widget>
</record_update>
